name: Keep Render Server Alive

on:
  schedule:
    # ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡ßß‡ß¶ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ‡¶™‡¶∞ ‡¶™‡¶∞ ‡¶∞‡¶æ‡¶® ‡¶ï‡¶∞‡¶¨‡ßá
    - cron: '*/10 * * * *'
  # ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶®‡ßÅ‡¶Ø‡¶º‡¶æ‡¶≤‡¶ø ‡¶∞‡¶æ‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
  workflow_dispatch:

jobs:
  ping-server:
    runs-on: ubuntu-latest
    steps:
      - name: Check current time
        run: echo "üïê Pinging server at $(date)"

      - name: Ping Render Server
        run: |
          # ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶ì‡¶Ø‡¶º‡¶æ‡¶ï ‡¶Ü‡¶™ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø GET ‡¶∞‡¶ø‡¶ï‡ßã‡¶Ø‡¶º‡ßá‡¶∏‡ßç‡¶ü
          echo "üì° Sending wake-up request..."
          
          # ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ
          HTTP_STATUS=$(curl -s -o response.txt -w "%{http_code}" \
            -L --connect-timeout 30 --max-time 60 \
            "https://liftakids.onrender.com/LiftAKids/api/health/wakeup")
          
          echo "üìä Response Status: $HTTP_STATUS"
          
          if [ "$HTTP_STATUS" -eq 200 ] || [ "$HTTP_STATUS" -eq 201 ] || [ "$HTTP_STATUS" -eq 202 ]; then
            echo "‚úÖ Server is awake and responding!"
            cat response.txt
          elif [ "$HTTP_STATUS" -eq 000 ]; then
            echo "‚ö†Ô∏è Connection failed - Server might be waking up..."
            echo "üîÑ Waiting 45 seconds for server to wake up..."
            sleep 45
          
            # ‡¶¶‡ßç‡¶¨‡¶ø‡¶§‡ßÄ‡¶Ø‡¶º ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ
            echo "üì° Retrying request..."
            HTTP_STATUS2=$(curl -s -o response2.txt -w "%{http_code}" \
              -L --connect-timeout 30 --max-time 60 \
              "https://liftakids.onrender.com/LiftAKids/api/health/wakeup")
          
            if [ "$HTTP_STATUS2" -eq 200 ] || [ "$HTTP_STATUS2" -eq 201 ] || [ "$HTTP_STATUS2" -eq 202 ]; then
              echo "‚úÖ Server is now awake on retry!"
              cat response2.txt
            else
              echo "‚ùå Server still not responding. Status: $HTTP_STATUS2"
              exit 1
            fi
          else
            echo "‚ùå Server responded with error status: $HTTP_STATUS"
            cat response.txt
            exit 1
          fi
          
          # ‡¶ï‡ßç‡¶≤‡¶ø‡¶®‡¶Ü‡¶™
          rm -f response.txt response2.txt

      - name: Log success
        if: success()
        run: echo "‚úÖ Server ping successful at $(date)"

      - name: Log failure
        if: failure()
        run: echo "‚ùå Server ping failed at $(date)"